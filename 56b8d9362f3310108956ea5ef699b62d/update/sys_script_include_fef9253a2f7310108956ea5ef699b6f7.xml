<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>x_caci_cisco_bcs.Cisco_AppUtil</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description/>
        <name>Cisco_AppUtil</name>
        <script><![CDATA[var Cisco_AppUtil = Class.create();
Cisco_AppUtil.prototype = {
    initialize: function() {
        this.logger = new Cisco_BCS_SNLogger();
        this.configuration = {
            "api": {
                "hardwareLifecycle": "/productAlerts/hwEox",
                "softwareLifecycle": "/productAlerts/swEox",
                "securityAdvisories": "/productAlerts/psirt",
                "fieldNotices": "/productAlerts/fieldNotices",
                "assets": "/inventory/assets",
                "devices": "/inventory/devices",
                "fieldNoticesBullitens": "/productAlerts/fnBulletins",
                "securityAdvisioriesBulletins": "/productAlerts/psirtBulletins",
                "hardwareLifecycleBulletins": "/productAlerts/hwEoxBulletins",
                "softwareLifecycleBulletins": "/productAlerts/swEoxBulletins",
                "cbpDetails": "/cbp/details",
                "cbpRules": "/cbp/rules",
                "cbpSummary": "/cbp/summary",
                "contractLifecycle": "/contract/serials",
                "cbpRulesReferences": "/cbp/rulesReferences"
            },
            "property": {
                "apiPrefix": gs.getProperty('x_caci_cisco_bcs.api.prefix') + '',
                "authSysId": gs.getProperty('x_caci_cisco_bcs.Authentication.Record'),
            }
        };
    },
    makeApiCall: function(method, endpoint, body, bcsAccount) {
        try {
			
            this.logger.debug("Inside Cisco_AppUtil.makeApiCall() performing API call to endpoint " + endpoint);
            var host = bcsAccount.host_name + '';
            var customerId = bcsAccount.customer_id + '';
            var apiKey = bcsAccount.api_key + '';
            var prefix = this.configuration.property.apiPrefix + '';
            var url = "https://" + host + "/" + prefix + "/" + customerId + endpoint;
			
			var request = new sn_ws.RESTMessageV2();
            request.setEndpoint(url);
            request.setHttpMethod(method);
            if (method == 'POST') {
                request.setRequestBody(body);
				request.setRequestHeader("Accept","application/json");
            	request.setRequestHeader("Content-Type","application/json");
            }
            request.setRequestHeader("x-api-key", apiKey);
      
            var response = request.execute();
            if (response.getStatusCode() + "" == "200" || response.getStatusCode() + "" == "201")
                return response;
            else{
				if(response.getStatusCode() + "" == "403")
					this.logger.error("Status Code is -" + response.getStatusCode()  + " Please check if the given customer id and API key is valid.");
				else if(response.getStatusCode() + "" == "0")
					this.logger.error("Status Code is -" + response.getStatusCode()  + " Could not connect to the host. Please check the host name and try again.");
				else if(response.getStatusCode() > 500)
					this.logger.error("Status Code is -" + response.getStatusCode()  + " Server error.");
				return response;
			}
        } catch (e) {
            this.logger.error("Exception caught inside Cisco_AppUtil.makeApiCall() while making API call to " + endpoint + ". Error :- " + e);
        }
    },
    parse: function(str) {
        if (str)
            return JSON.parse(str);
        return '';
    },
    stringify: function(str) {
        if (str)
            return JSON.stringify(str);
        return '';
    },
    type: 'Cisco_AppUtil'
};]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2020-10-15 13:51:40</sys_created_on>
        <sys_id>fef9253a2f7310108956ea5ef699b6f7</sys_id>
        <sys_mod_count>33</sys_mod_count>
        <sys_name>Cisco_AppUtil</sys_name>
        <sys_package display_value="Cisco BCS Operational Insights" source="x_caci_cisco_bcs">56b8d9362f3310108956ea5ef699b62d</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="Cisco BCS Operational Insights">56b8d9362f3310108956ea5ef699b62d</sys_scope>
        <sys_update_name>sys_script_include_fef9253a2f7310108956ea5ef699b6f7</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2021-05-12 14:56:58</sys_updated_on>
    </sys_script_include>
</record_update>
